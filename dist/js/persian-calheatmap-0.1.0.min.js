/*
  persian-calheatmap - v0.1.0 
  Author: reza babakhani 
 http://babakhani.github.io/PersianWebToolkit/heatchart 
 */
(function(){(function(t){t.Zebra_Tooltips=function(e,i){var o,n,a,r,s={animation_speed:250,animation_offset:20,background_color:"#000",close_on_click:!0,color:"#FFF",content:!1,default_position:"above",hide_delay:100,keep_visible:!0,max_width:250,opacity:".95",position:"center",prerender:!1,show_delay:100,vertical_offset:0,onBeforeHide:null,onHide:null,onBeforeShow:null,onShow:null},l=this;l.settings={},l.hide=function(e,i){e.each(function(){var e=t(this),o=e.data("Zebra_Tooltip");o&&(o.sticky=!1,i&&(o.destroy=!0),e.data("Zebra_Tooltip",o),h(e))})},l.show=function(e,i){e.each(function(){var e=t(this),o=e.data("Zebra_Tooltip");o&&(o.sticky=!0,o.muted=!1,i&&(o.destroy=!0),e.data("Zebra_Tooltip",o),c(e))})};var d=function(e){var i=e.data("Zebra_Tooltip");if(!i.tooltip){var s=jQuery("<div>",{"class":"Zebra_Tooltip",css:{opacity:0,display:"block"}}),d=jQuery("<div>",{"class":"Zebra_Tooltip_Message",css:{"max-width":l.settings.max_width,"background-color":l.settings.background_color,color:l.settings.color}}).html(l.settings.content?l.settings.content:i.content).appendTo(s),i=jQuery("<div>",{"class":"Zebra_Tooltip_Arrow"}).appendTo(s),u=jQuery("<div>").appendTo(i);l.settings.keep_visible&&(s.bind("mouseleave"+(l.settings.close_on_click?" click":""),function(){h(e)}),s.bind("mouseenter",function(){c(e)})),s.appendTo("body");var f=s.outerWidth(),p=s.outerHeight(),_=u.outerWidth(),w=u.outerHeight(),m=d.outerWidth(),g=d.outerHeight(),i={tooltip:s,tooltip_width:f,tooltip_height:p+w/2,message:d,arrow_container:i,arrow_width:_,arrow_height:w,arrow:u};s.css({width:i.tooltip_width,height:i.tooltip_height}),i.tooltip_width+=d.outerWidth()-m,i.tooltip_height+=d.outerHeight()-g,s.css({width:i.tooltip_width,height:i.tooltip_height,display:"none"}),i=t.extend(e.data("Zebra_Tooltip"),i),e.data("Zebra_Tooltip",i)}return i.sticky&&!i.close&&(jQuery("<a>",{"class":"Zebra_Tooltip_Close",href:"javascript:void(0)"}).html("x").bind("click",function(t){t.preventDefault(),t=e.data("Zebra_Tooltip"),t.sticky=!1,e.data("Zebra_Tooltip",t),h(e)}).appendTo(i.message),i.close=!0,i=t.extend(e.data("Zebra_Tooltip"),i),e.data("Zebra_Tooltip",i)),(i.window_resized||i.window_scrolled)&&(s=t(window),i.window_resized&&(o=s.width(),n=s.height(),d=e.offset(),t.extend(i,{element_left:d.left,element_top:d.top,element_width:e.outerWidth(),element_height:e.outerHeight()})),r=s.scrollTop(),a=s.scrollLeft(),s="left"==l.settings.position?i.element_left-i.tooltip_width+i.arrow_width:"right"==l.settings.position?i.element_left+i.element_width-i.arrow_width:i.element_left+(i.element_width-i.tooltip_width)/2,d=i.element_top-i.tooltip_height,m="left"==l.settings.position?i.tooltip_width-i.arrow_width-i.arrow_width/2:"right"==l.settings.position?i.arrow_width/2:(i.tooltip_width-i.arrow_width)/2,s+i.tooltip_width>o+a&&(m-=o+a-(s+i.tooltip_width)-6,s=o+a-i.tooltip_width-6,m+i.arrow_width>i.tooltip_width-6&&(m=i.tooltip_width-6-i.arrow_width),s+m+i.arrow_width/2<i.element_left&&(m=-1e4)),a>s&&(m-=a-s,s=a+2,0>m&&(m=i.arrow_width/2),s+m+i.arrow_width/2>i.element_left+i.element_width&&(m=-1e4)),i.arrow_container.removeClass("Zebra_Tooltip_Arrow_Top"),i.arrow_container.addClass("Zebra_Tooltip_Arrow_Bottom"),i.message.css("margin-top",""),i.arrow.css("borderColor",l.settings.background_color+" transparent transparent"),r>d||"below"==l.settings.default_position&&n+r>i.element_top+i.element_height+l.settings.vertical_offset+i.tooltip_height+i.animation_offset?(d=i.element_top+i.element_height-l.settings.vertical_offset,i.animation_offset=Math.abs(i.animation_offset),i.message.css("margin-top",i.arrow_height/2),i.arrow_container.removeClass("Zebra_Tooltip_Arrow_Bottom"),i.arrow_container.addClass("Zebra_Tooltip_Arrow_Top"),i.arrow.css("borderColor","transparent transparent "+l.settings.background_color)):(i.animation_offset=-Math.abs(i.animation_offset),d+=l.settings.vertical_offset),i.arrow_container.css("left",m),i.tooltip.css({left:s,top:d}),t.extend(i,{tooltip_left:s,tooltip_top:d,arrow_left:m}),i.window_resized=!1,i.window_scrolled=!1,i=t.extend(e.data("Zebra_Tooltip"),i),e.data("Zebra_Tooltip",i)),i},h=function(e){var i=e.data("Zebra_Tooltip");clearTimeout(i.hide_timeout),i.sticky||(clearTimeout(i.show_timeout),i.hide_timeout=setTimeout(function(){i.tooltip&&(l.settings.onBeforeHide&&"function"==typeof l.settings.onBeforeHide&&l.settings.onBeforeHide(e,i.tooltip),i.close=!1,i.destroy&&(i.muted=!0),e.data("Zebra_Tooltip",i),t("a.Zebra_Tooltip_Close",i.tooltip).remove(),i.tooltip.stop(),i.tooltip.animate({opacity:0,top:i.tooltip_top+i.animation_offset},l.settings.animation_speed,function(){t(this).css("display","none"),l.settings.onHide&&"function"==typeof l.settings.onHide&&l.settings.onHide(e,i.tooltip)}))},l.settings.hide_delay))},c=function(t){var e=t.data("Zebra_Tooltip");clearTimeout(e.show_timeout),e.muted||(clearTimeout(e.hide_timeout),e.show_timeout=setTimeout(function(){e=d(t),l.settings.onBeforeShow&&"function"==typeof l.settings.onBeforeShow&&l.settings.onBeforeShow(t,e.tooltip),"block"!=e.tooltip.css("display")&&e.tooltip.css({top:e.tooltip_top+e.animation_offset}),e.tooltip.css("display","block"),e.tooltip.stop(),e.tooltip.animate({top:e.tooltip_top,opacity:l.settings.opacity},l.settings.animation_speed,function(){l.settings.onShow&&"function"==typeof l.settings.onShow&&l.settings.onShow(t,e.tooltip)})},l.settings.show_delay))};(function(){l.settings=t.extend({},s,i),e.each(function(){var e=t(this),i=e.attr("title"),o=e.data("zebra-tooltip");(i&&""!==i||o&&""!==o||void 0!==l.settings.content)&&(e.bind({mouseenter:function(){c(e)},mouseleave:function(){h(e)}}),e.data("Zebra_Tooltip",{tooltip:null,content:o||i||"",window_resized:!0,window_scrolled:!0,show_timeout:null,hide_timeout:null,animation_offset:l.settings.animation_offset,sticky:!1,destroy:!1,muted:!1}),e.attr("title",""),l.settings.prerender&&d(e))}),t(window).bind("scroll resize",function(i){e.each(function(){var e=t(this).data("Zebra_Tooltip");e&&("scroll"==i.type?e.window_scrolled=!0:e.window_resized=!0,t(this).data("Zebra_Tooltip",e))})})})()}})(jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var r=e||window.event,s=l.call(arguments,1),d=0,c=0,u=0,f=0,p=0,_=0;if(e=t.event.fix(r),e.type="mousewheel","detail"in r&&(u=-1*r.detail),"wheelDelta"in r&&(u=r.wheelDelta),"wheelDeltaY"in r&&(u=r.wheelDeltaY),"wheelDeltaX"in r&&(c=-1*r.wheelDeltaX),"axis"in r&&r.axis===r.HORIZONTAL_AXIS&&(c=-1*u,u=0),d=0===u?c:u,"deltaY"in r&&(u=-1*r.deltaY,d=u),"deltaX"in r&&(c=r.deltaX,0===u&&(d=-1*c)),0!==u||0!==c){if(1===r.deltaMode){var w=t.data(this,"mousewheel-line-height");d*=w,u*=w,c*=w}else if(2===r.deltaMode){var m=t.data(this,"mousewheel-page-height");d*=m,u*=m,c*=m}if(f=Math.max(Math.abs(u),Math.abs(c)),(!a||a>f)&&(a=f,o(r,f)&&(a/=40)),o(r,f)&&(d/=40,c/=40,u/=40),d=Math[d>=1?"floor":"ceil"](d/a),c=Math[c>=1?"floor":"ceil"](c/a),u=Math[u>=1?"floor":"ceil"](u/a),h.settings.normalizeOffset&&this.getBoundingClientRect){var g=this.getBoundingClientRect();p=e.clientX-g.left,_=e.clientY-g.top}return e.deltaX=c,e.deltaY=u,e.deltaFactor=a,e.offsetX=p,e.offsetY=_,e.deltaMode=0,s.unshift(e,d,c,u),n&&clearTimeout(n),n=setTimeout(i,200),(t.event.dispatch||t.event.handle).apply(this,s)}}function i(){a=null}function o(t,e){return h.settings.adjustOldDeltas&&"mousewheel"===t.type&&0===e%120}var n,a,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(t.event.fixHooks)for(var d=r.length;d;)t.event.fixHooks[r[--d]]=t.event.mouseHooks;var h=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=s.length;i;)this.addEventListener(s[--i],e,!1);else this.onmousewheel=e;t.data(this,"mousewheel-line-height",h.getLineHeight(this)),t.data(this,"mousewheel-page-height",h.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=s.length;i;)this.removeEventListener(s[--i],e,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var i=t(e),o=i["offsetParent"in t.fn?"offsetParent":"parent"]();return o.length||(o=t("body")),parseInt(o.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),$.mustache=function(t,e){return String.prototype.format=function(t){function e(e){var i=e.slice(2,-2).split("."),o=i[0],n=i[1];return t[o]instanceof Object?t[o][n]:t[o]}return this.replace(/{{\s*[\w\.]+\s*}}/g,e)},$(t.format(e))};var t={monthTitleFormat:"MMMM",startDate:new pDate([(new pDate).year(),1,1,1,1,1,1]),endDate:(new pDate).endOf("year"),weekDayTitle:["شنبه","یکشنبه","دوشنبه","سشنبه","چهارشنبه","پنجشنبه","جمعه"],dayWidth:"30",dayHeight:"30",data:{},days:{renderData:function(){},label:{enabled:!0,format:"DD",formatter:function(t,e){return e.format("DD")}},tooltip:{enabled:!0,formatter:function(){},background_color:"#333333",color:"#ffffff",animation_speed:250,animation_offset:20,close_on_click:!0,default_position:"above",hide_delay:100,keep_visible:!0,max_width:200,opacity:.85,position:"center",prerender:!1,show_delay:100,vertical_offset:0}}},e={monthTitleFormat:"MMMM",label:{enabled:!0,format:"D",formatter:function(t){return t.underRenderDate.format(t.label.format)}},tooltip:{enabled:!1},startDate:"",endDate:"",underRenderDate:!1,data:"",_basicRender:function(){for(var t=this,e=t.endDate.diff(t.startDate,"week")+1,i=0;e>i;){var o=$.mustache(a.weekBox,{});o.appendTo(t.$container),i++}return this},getPersianDayOfweekIndex:function(t){return 7==t?1:t+1},_renderDaysContent:function(){var t=this,e="alternat",i=new pDate;return 0==t.underRenderDate&&(t.underRenderDate=t.startDate),t.$container.find(".week-box").each(function(){var o=$(this);$(this).find("li").each(function(n){var a=t.getPersianDayOfweekIndex(t.underRenderDate.days()),r=t.underRenderDate.date();if(1==r&&(e="alternat"==e?"":"alternat"),a==n+1&&t.underRenderDate.unix()<t.endDate.unix()){var s=t.underRenderDate.years()+""+t.leftZeroFill(t.underRenderDate.month(),2)+t.leftZeroFill(t.underRenderDate.dates(),2),l=t.underRenderDate.valueOf();$(this).attr({dateKey:s,dateUnix:l}).addClass("have-day").addClass(e),t.label.enabled&&$(this).html(t.label.formatter(t,t.underRenderDate)),t.underRenderDate.years()==i.years()&&t.underRenderDate.date()==i.date()&&t.underRenderDate.month()==i.month()&&$(this).addClass("today"),t.underRenderDate=t.underRenderDate.add("days",1)}if(1==r&&$(this).is("[dateunix]")){var d=$('<div class="month-title" ></div>').text(t.underRenderDate.format(t.monthTitleFormat));o.append(d)}})}),this},leftZeroFill:function(t,e){for(var i=t+"";e>i.length;)i="0"+i;return i},_applyTooltip:function(){var t=this;return $(t.$container).find(".week-box li.have-day").each(function(){var e=this,i=$(this).attr("dateKey");t.data[i]&&new $.Zebra_Tooltips($(e),$.extend(!0,t.tooltip,{content:t.data[i].data}))}),this},render:function(t,e){return t.css({background:e.color}),this},applyData:function(t){var e=this;return $.each(t,function(t,i){var o=e.$container.find(".week-box li[datekey="+t+"]");e.render(o,i)}),this},_init:function(){var t=this;return this._basicRender(),this._renderDaysContent(),t.tooltip.enabled&&this._applyTooltip(),this.applyData(t.data),this}},i=function(t,i,o){return $.extend(!0,this,e,i,o,{$container:t}),this.startDate=i.startDate,this.endDate=i.endDate,this._init()},o={_bootstrap:function(){var t=this;return this.elem=$.mustache(a.basic,{}),this.elem.appendTo(t.$container),this.startDate=new pDate(t.startDate),this.endDate=new pDate(t.endDate),this},_renderDays:function(){var t=this,e=this.elem.find(".days-container > div");return this._days=new i(e,{startDate:t.startDate,endDate:t.endDate,data:t.data,tooltipFormatter:t.tooltipFormatter,monthTitleFormat:t.monthTitleFormat},t.days),this},_setWeekDayTitle:function(){var t=this;return t.$container.find(".week-box-title li").each(function(e){t.weekDayTitle[e]&&$(this).html(t.weekDayTitle[e])}),this},_setLayoutSize:function(){var t=this;t.$container.find(".week-box-title li").height(t.dayHeight),t.$container.find(".week-box li").height(t.dayHeight).width(t.dayWidth).css({"line-height":t.dayHeight+"px"}),t.$container.find(".week-box").height();var e=t.$container.find(".month-title").height(),i=t.$container.find(".week-box"),o=i.outerWidth()*i.length;t.$container.find(".days-container > div").width(o);var n=t.$container.find(".persian-hit-chart").width(),a=7*t.dayHeight+e;return o>n&&(a+=20),t.$container.find(".days-container").height(a),t.$container.find(".persian-heat-map-chart").height(a),this},_attachEvents:function(){var t=this,e=t.$container.find(".days-container"),i=t.$container.find(".days-container >  div");return i.width()-e.width(),this.$container.on("mousewheel",function(t,e){val=this.scrollLeft-50*e,jQuery(this).stop().animate({scrollLeft:val},500)}),this},_init:function(){return this._bootstrap()._setWeekDayTitle()._renderDays()._attachEvents()._setLayoutSize()}},n=function(e,i){return $.extend(!0,this,o,t,i,{$container:$(e)}),this._init()},a={basic:'<div class="persian-heat-map-chart" ><ul class="week-box-title" ><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><div class="days-container" ><div></div>',weekBox:'<ul class="week-box" ><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>'};$.fn.persianHitChart=$.fn.persianHitChart=function(t){var e=Array.prototype.slice.call(arguments),i=this;return this||$.error("Invalid selector"),$(this).each(function(){var o=[],a=e.concat(o),r=$(this).data("persianHitChart");if(r&&"string"==typeof a[0]){var s=a[0];a.splice(0,1),i=r[s](a)}else this.persianHitChart=new n(this,t)}),i}})();